var e=Object.assign;import{o as t,c as n,r as s,m as a,a as r,b as l,w as o,d as i,e as d,f as c,v as u,F as p,p as _,g as m,S as v,h,i as f,t as y,j as w,k as $,l as g,s as b,n as k,T as S,q as x}from"./vendor.7463a449.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const s=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,r)=>{const l=new URL(e,s);if(self[t].moduleMap[l])return n(self[t].moduleMap[l]);const o=new Blob([`import * as m from '${l}';`,`${t}.moduleMap['${l}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){r(new Error(`Failed to import: ${e}`)),a(i)},onload(){n(self[t].moduleMap[l]),a(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/random-wheel/assets/");var I={primary:"_primary_8hg3b_1",secondary:"_secondary_8hg3b_11",danger:"_danger_8hg3b_22",button:"_button_8hg3b_33",default:"_default_8hg3b_46",squared:"_squared_8hg3b_52"};const M={name:"Button",props:{appearance:{type:String,default:"primary",validator:e=>-1!==["primary","secondary","danger"].indexOf(e)},view:{type:String,default:"default",validator:e=>-1!==["default","squared"].indexOf(e)}}};(M.__cssModules={}).$style=I,M.render=function(e,r,l,o,i,d){return t(),n("button",a({class:[e.$style.button,e.$style[e.$props.appearance],e.$style[e.$props.view]]},e.$attrs),[s(e.$slots,"default")],16)};const P={name:"CloseIcon"},L={width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},B=r("path",{d:"M1 1L13 13",stroke:"currentColor"},null,-1),W=r("path",{d:"M13 1L1 13",stroke:"currentColor"},null,-1);P.render=function(e,s,a,r,l,o){return t(),n("svg",L,[B,W])};var j={backdrop:"_backdrop_1k1he_2",modal:"_modal_1k1he_14",closeButton:"_close-button_1k1he_24"};const A={name:"Modal",components:{CloseIcon:P}};(A.__cssModules={}).$style=j,A.render=function(e,a,i,d,c,u){const p=l("CloseIcon");return t(),n("div",{class:e.$style.backdrop,onClick:a[2]||(a[2]=o((t=>e.$emit("close-modal")),["self"]))},[r("div",{class:e.$style.modal},[r("div",{class:e.$style.closeButton,onClick:a[1]||(a[1]=t=>e.$emit("close-modal"))},[r(p)],2),s(e.$slots,"default")],2)],2)};var V={header:"_header_bohle_1",inner:"_inner_bohle_7"};const C={name:"Header",components:{Button:M}},O=d("Настройки");(C.__cssModules={}).$style=V,C.render=function(e,s,a,o,d,c){const u=l("Button");return t(),n("div",{class:e.$style.header},[r("div",{class:e.$style.inner},[r(u,{onClick:s[1]||(s[1]=t=>e.$emit("open-modal"))},{default:i((()=>[O])),_:1})],2)],2)};const q={name:"Link",props:{isExternalLink:{type:Boolean}},computed:{allProps(){const t={};return this.isExternalLink&&(t.target="_blank",t.rel="nofollow noopener noreferrer"),e(e({},this.$attrs),t)}}};(q.__cssModules={}).$style={},q.render=function(e,a,r,l,o,i){return t(),n("a",i.allProps,[s(e.$slots,"default")],16)};var D={footer:"_footer_wumne_1",inner:"_inner_wumne_7",icon:"_icon_wumne_13",linkWrapper:"_link-wrapper_wumne_25",mr:"_mr_wumne_30",ml:"_ml_wumne_35",link:"_link_wumne_25"};const T={name:"Footer",components:{Link:q}},F=r("img",{src:"https://avatars.githubusercontent.com/u/8355785",alt:"MissedWarrior"},null,-1);(T.__cssModules={}).$style=D,T.render=function(e,s,a,o,d,c){const u=l("Link");return t(),n("div",{class:e.$style.footer},[r("div",{class:e.$style.inner},[r("div",{class:e.$style.linkWrapper},[r("div",{class:e.$style.mr},"Made by",2),r(u,{"is-external-link":"",href:"https://github.com/missedwarrior",class:e.$style.link},{default:i((()=>[r("div",{class:e.$style.icon},[F],2),r("div",{class:e.$style.ml},"@MissedWarrior",2)])),_:1},8,["class"])],2)],2)],2)};const U=(e,t)=>localStorage.setItem(e,t),E=e=>localStorage.getItem(e),R=e=>localStorage.removeItem(e);var N={input:"_input_1jd4o_1"};const z={name:"Input",props:["modelValue"],emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}};(z.__cssModules={}).$style=N,z.render=function(e,s,r,l,o,i){return c((t(),n("input",a(e.$attrs,{type:e.$attrs.type,"onUpdate:modelValue":s[1]||(s[1]=e=>i.value=e),class:e.$style.input}),null,16,["type"])),[[u,i.value]])};var J={wrapper:"_wrapper_9oj7u_1",label:"_label_9oj7u_7",labelWrapper:"_label-wrapper_9oj7u_13",button:"_button_9oj7u_17",inputWrapper:"_input-wrapper_9oj7u_22"};const H={name:"AddPoint",components:{Button:M,Input:z},data:()=>({newPoint:""}),methods:{handleSubmit(){var e;(null==(e=this.newPoint)?void 0:e.length)>0&&(this.$emit("add-point",this.newPoint),this.newPoint="",this.$refs.input.$el.focus())}}},G=r("span",null,"Добавить новый пункт колеса:",-1),K=d("Добавить");(H.__cssModules={}).$style=J,H.render=function(e,s,a,d,c,u){const p=l("Input"),_=l("Button");return t(),n("form",{class:e.$style.wrapper,onSubmit:s[2]||(s[2]=o(((...e)=>u.handleSubmit&&u.handleSubmit(...e)),["prevent"]))},[r("div",{class:e.$style.labelWrapper},[r("label",{class:e.$style.label,for:"addPoint"},[G],2),r("div",{class:e.$style.inputWrapper},[r(p,{id:"addPoint",name:"addPoint",modelValue:c.newPoint,"onUpdate:modelValue":s[1]||(s[1]=e=>c.newPoint=e),modelModifiers:{trim:!0},autocomplete:"off",ref:"input"},null,8,["modelValue"])],2)],2),r("div",{class:e.$style.button},[r(_,null,{default:i((()=>[K])),_:1})],2)],34)};const Q={name:"BackgroundImage"},X=r("div",null," BackgroundImage ",-1),Y=r("div",null," Coming soon (c) ",-1);(Q.__cssModules={}).$style={},Q.render=function(e,s,a,r,l,o){return t(),n(p,null,[X,Y],64)};var Z={label:"_label_5ifuj_1",input:"_input_5ifuj_5",primary:"_primary_5ifuj_9",secondary:"_secondary_5ifuj_19",button:"_button_5ifuj_30"};const ee={name:"InputFile",props:{appearance:{type:String,default:"primary",validator:e=>-1!==["primary","secondary"].indexOf(e)}},methods:{uploadFile(e){this.$emit("upload",e)}}};(ee.__cssModules={}).$style=Z,ee.render=function(e,l,o,i,d,c){return t(),n("label",{class:e.$style.label},[r("input",a(e.$attrs,{class:e.$style.input,type:"file",onChange:l[1]||(l[1]=(...e)=>c.uploadFile&&c.uploadFile(...e))}),null,16),r("div",{class:[e.$style.button,e.$style[e.$props.appearance]]},[s(e.$slots,"default")],2)],2)};var te={wrapper:"_wrapper_3wi47_1",importWrapper:"_import-wrapper_3wi47_7",exportWrapper:"_export-wrapper_3wi47_14"};const ne={name:"DataTransfer",components:{Button:M,InputFile:ee},methods:{importData(e){this.$emit("import-data",e)},exportData(){this.$emit("export-data")}}},se=r("div",null,[r("span",null,"Импортировать список")],-1),ae=d("Импорт..."),re=r("div",null,[r("span",null,"Экспортировать список")],-1),le=d("Экспорт");(ne.__cssModules={}).$style=te,ne.render=function(e,s,a,o,d,c){const u=l("InputFile"),p=l("Button");return t(),n("div",{class:e.$style.wrapper},[r("div",{class:e.$style.importWrapper},[se,r("div",null,[r(u,{accept:"application/json",onUpload:c.importData},{default:i((()=>[ae])),_:1},8,["onUpload"])])],2),r("div",{class:e.$style.exportWrapper},[re,r("div",null,[r(p,{appearance:"secondary",onClick:c.exportData},{default:i((()=>[le])),_:1},8,["onClick"])])],2)],2)};var oe={wrapper:"_wrapper_1qfhu_1",break:"_break_1qfhu_11",keep:"_keep_1qfhu_16",hide:"_hide_1qfhu_20",left:"_left_1qfhu_26",center:"_center_1qfhu_30",right:"_right_1qfhu_34"};const ie={name:"Point",props:{overflowStyle:{type:String,default:"keep",validator:e=>-1!==["keep","break","hide"].indexOf(e)},forceTitle:{type:Boolean,default:!1},title:{type:String},align:{type:String,default:"left",validator:e=>-1!==["left","center","right"].indexOf(e)}}};(ie.__cssModules={}).$style=oe,ie.render=function(e,a,l,o,i,d){return t(),n("div",{class:[e.$style.wrapper,e.$style[l.align]],ref:"wrapper"},[r("div",{class:e.$style[l.overflowStyle],title:l.title,ref:"inner"},[s(e.$slots,"default")],10,["title"])],2)};const de={name:"simplebar-vue",data:()=>({instance:null}),mounted(){const e=v.getOptions(this.$attrs);this.instance=new v(this.$refs.element,e)},beforeUnmount(){var e;null==(e=this.instance)||e.unMount()},computed:{scrollElement(){return this.$refs.scrollElement},contentElement(){return this.$refs.contentElement}}},ce=h("data-v-62758100");_("data-v-62758100");const ue={class:"simplebar-wrapper"},pe=r("div",{class:"simplebar-height-auto-observer-wrapper"},[r("div",{class:"simplebar-height-auto-observer"})],-1),_e={class:"simplebar-mask"},me={class:"simplebar-offset"},ve={class:"simplebar-content-wrapper",ref:"scrollElement"},he={class:"simplebar-content",ref:"contentElement"},fe=r("div",{class:"simplebar-placeholder"},null,-1),ye=r("div",{class:"simplebar-track simplebar-horizontal"},[r("div",{class:"simplebar-scrollbar"})],-1),we=r("div",{class:"simplebar-track simplebar-vertical"},[r("div",{class:"simplebar-scrollbar"})],-1);m();const $e=ce(((e,l,o,i,d,c)=>(t(),n("div",a({ref:"element"},e.$attrs,{class:"wrapper"}),[r("div",ue,[pe,r("div",_e,[r("div",me,[r("div",ve,[r("div",he,[s(e.$slots,"default")],512)],512)])]),fe]),ye,we],16))));de.render=$e,de.__scopeId="data-v-62758100";var ge={svg:"_svg_4to29_1"};const be={name:"Trash"},ke=r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1);(be.__cssModules={}).$style=ge,be.render=function(e,s,r,l,o,i){return t(),n("svg",a({fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e.$attrs,{class:e.$style.svg}),[ke],16)};var Se={wrapper:"_wrapper_1ql28_1",inner:"_inner_1ql28_8",listItem:"_list-item_1ql28_12",iconWrapper:"_icon-wrapper_1ql28_21",button:"_button_1ql28_25",icon:"_icon_1ql28_21",point:"_point_1ql28_36"};const xe={name:"PointsList",components:{Trash:be,Button:M,Point:ie,Simplebar:de},props:{list:{type:Array,required:!0}},methods:{removePoint(e){this.$emit("remove-point",e)}}};(xe.__cssModules={}).$style=Se,xe.render=function(e,s,a,o,c,u){const _=l("Point"),m=l("Trash"),v=l("Button"),h=l("Simplebar");return t(),n("div",{class:e.$style.wrapper},[r(h,null,{default:i((()=>[r("div",{class:e.$style.inner},[(t(!0),n(p,null,f(a.list,(s=>(t(),n("div",{class:e.$style.listItem,key:s.id},[r("div",{class:e.$style.point},[r(_,{"overflow-style":"break"},{default:i((()=>[d(y(s.value),1)])),_:2},1024)],2),r("div",{class:e.$style.iconWrapper},[r(v,{appearance:"danger",view:"squared",class:e.$style.button,ref:"button",onClick:e=>u.removePoint(s.id)},{default:i((()=>[r("div",{class:e.$style.icon},[r(m)],2)])),_:2},1032,["class","onClick"])],2)],2)))),128))],2)])),_:1})],2)};var Ie={wrapper:"_wrapper_12rpg_1",label:"_label_12rpg_6"};const Me={name:"SearchPoints",components:{Input:z},methods:{handleInput(e){const{value:t}=e.target;this.$emit("search",t)}}};(Me.__cssModules={}).$style=Ie,Me.render=function(e,s,a,o,i,d){const c=l("Input");return t(),n("label",{class:e.$style.wrapper},[r("div",{class:e.$style.label},"Поиск по списку",2),r(c,{onInput:d.handleInput},null,8,["onInput"])],2)};var Pe={addPoint:"_add-point_p01fr_1",searchPoints:"_search-points_p01fr_5",pointsList:"_points-list_p01fr_9",dataTransfer:"_data-transfer_p01fr_13"};const Le={name:"Settings",components:{AddPoint:H,BackgroundImage:Q,DataTransfer:ne,PointsList:xe,SearchPoints:Me},inject:["wheelStore"],data:()=>({searchValue:""}),computed:{resultList(){const e=this.wheelStore.getActiveList();return this.searchValue.length>0?e.filter((e=>e.value.includes(this.searchValue))):e}},methods:{addPoint(e){this.wheelStore.addVariant(e)},removePoint(e){this.wheelStore.removeVariant(e)},handleSearch(e){this.searchValue=e},importData(e){const{files:t}=e.target,n=t[0];if(!n)return;if("application/json"!==n.type)return alert("Импортируемый файл должен быть с расширением .json");const s=new FileReader;s.readAsText(n),s.onload=()=>{let e;try{e=JSON.parse(s.result)}catch(n){return alert("Не удалось импортировать схему: данные повреждены.")}const t=(e=>{if(!e||"object"!=typeof e)return{isValid:!1,reason:"Некорректные входные данные"};if("v1"!==e.version)return{isValid:!1,reason:"Версия схемы не поддерживается"};if(Array.isArray(e.data))return e.data.every((e=>Boolean(e.value)))?{isValid:!0}:{isValid:!1,reason:"Сохранённый список повреждён"};return{isValid:!1,reason:"Произошла непредвиденная ошибка. Не удалось импортировать схему"}})(e);t.isValid||alert(t.reason),confirm("Внимание! В результате импорта ВСЕ текущие данные будут перезаписаны. Вы согласны?")&&(this.wheelStore.setNewVariants(e.data),alert("Данные успешно импортированы!"))},s.onerror=()=>{alert(`Не удалось считать файл по следующей причине: ${s.error}`)}},exportData(){const e=this.wheelStore.getActiveList(),t=(n=e,{version:"v1",saveDate:(new Date).toUTCString(),saveDateTimezone:"UTC",data:n});var n;const s=new Blob([JSON.stringify(t)],{type:"application/json"}),a=document.createElement("a");a.download="config-schema.json",a.href=URL.createObjectURL(s),a.click()}}};(Le.__cssModules={}).$style=Pe,Le.render=function(e,s,a,o,i,d){const c=l("AddPoint"),u=l("SearchPoints"),_=l("PointsList"),m=l("DataTransfer"),v=l("BackgroundImage");return t(),n(p,null,[r("div",{class:e.$style.addPoint},[r(c,{onAddPoint:d.addPoint},null,8,["onAddPoint"])],2),r("div",{class:e.$style.searchPoints},[r(u,{onSearch:d.handleSearch},null,8,["onSearch"])],2),r("div",{class:e.$style.pointsList},[r(_,{list:d.resultList,onRemovePoint:d.removePoint},null,8,["list","onRemovePoint"])],2),r("div",{class:e.$style.dataTransfer},[r(m,{onImportData:d.importData,onExportData:d.exportData},null,8,["onImportData","onExportData"])],2),r("div",{class:e.$style.backgroundImage},[r(v)],2)],64)};const Be=()=>Date.now().toString(),We=t=>{let n;if(t){const e=E(t);if(e)try{n=JSON.parse(e)}catch(r){console.error("Corrupted randomizer storage data, creating new one"),R(t)}}const s=$(n||e({},{seed:Be(),count:0}));g(s.value,(()=>{U(t,JSON.stringify(s.value))}));const a=function*(){let e=b(s.value.seed);for(;;){const t=yield e();t&&(e=b(t),s.value.seed=t)}}();for(let e=0;e<s.value.count;e++)a.next();return{state:w(s),rng:()=>{if(s.value.count+=1,s.value.count>=200)return s.value.count=0,a.next(Be()).value;const{value:e}=a.next();return s.value.lastNumber=e,e}}};var je={wrapper:"_wrapper_1cy3a_1",winner:"_winner_1cy3a_8",winnerText:"_winner-text_1cy3a_18"};const Ae={name:"ButtonField",components:{Button:M},props:{rouletteList:{type:Array,required:!0},disabled:{type:Boolean,default:!1},winner:{type:String}}},Ve=r("div",null,y("Победил вариант "),-1),Ce=d(" Запустить рулетку! ");(Ae.__cssModules={}).$style=je,Ae.render=function(e,s,a,o,d,c){const u=l("Button");return t(),n("div",{class:e.$style.wrapper},[a.winner?(t(),n("div",{key:0,class:e.$style.winner},[Ve,r("div",{class:e.$style.winnerText},y(`"${a.winner}"!`),3)],2)):k("",!0),r("div",null,[r(u,{onClick:s[1]||(s[1]=t=>e.$emit("activate-wheel")),disabled:0===a.rouletteList.length||a.disabled,"data-test-id":"activate-wheel"},{default:i((()=>[Ce])),_:1},8,["disabled"])])],2)};var Oe={wrapper:"_wrapper_1xsvn_1",wheelWrapper:"_wheel-wrapper_1xsvn_9",point:"_point_1xsvn_17",central:"_central_1xsvn_22",middle:"_middle_1xsvn_27",edge:"_edge_1xsvn_32"};const qe=new Audio("/random-wheel/assets/lalahey.f63ed025.mp3");qe.volume=.07;const De={name:"Wheel",components:{Point:ie,ButtonField:Ae},inject:["wheelStore"],setup(){const{rng:e,state:t}=We("roulette-seed");return{randomizer:{rng:e,state:t}}},data:()=>({isWheelActive:!1,currentIndex:0,timerId:0,winner:null}),computed:{rouletteList(){const e=this.currentIndex,t=this.wheelStore.getActiveList();if(t.length>0){const n=[];for(let s=0;s<5;s++){const a=t[(e+s)%t.length],r=this.assignClass(a,s);n.push(r)}return n}return[]}},methods:{activateWheel(){const e=this.wheelStore.getActiveList();this.currentIndex=this.randomInteger(0,e.length-1),this.isWheelActive=!0,this.winner=null,qe.play();const t=1e3*qe.duration;this.timerId=this.rotateWheel(),setTimeout((()=>{clearInterval(this.timerId),this.isWheelActive=!1,qe.volume=.07,this.winner=this.rouletteList[Math.floor(2.5)].value}),t)},rotateWheel(){const e=this;let t=100;const{duration:n}=qe,s=this.wheelStore.getActiveList();return setTimeout((function a(){if(e.timerId=setTimeout(a,t),e.currentIndex<s.length-1)e.currentIndex+=1;else{if(e.currentIndex!==s.length-1)throw new Error(`Array is out of bounds, tried to get ${e.currentIndex} while max index is ${s.length-1}`);e.currentIndex=0}const{currentTime:r}=qe;r>.85*n?(qe.volume=.04,t=400):r>.7*n?(qe.volume=.06,t=200):t=100}),t)},assignClass(t,n){const s=e({},t);switch(n){case 0:case 4:s.class=this.$style.edge;break;case Math.floor(2.5):s.class=this.$style.central;break;default:s.class=this.$style.middle}return s},randomInteger(e,t){const n=e+this.randomizer.rng()*(t+1-e);return Math.floor(n)}}},Te={key:1};(De.__cssModules={}).$style=Oe,De.render=function(e,s,a,o,c,u){const _=l("Point"),m=l("ButtonField");return t(),n("div",{class:e.$style.wrapper},[r("div",{class:e.$style.wheelWrapper},[u.rouletteList.length>0?(t(!0),n(p,{key:0},f(u.rouletteList,(s=>(t(),n("div",{class:e.$style.point},[r("div",{class:s.class},[r(_,{"overflow-style":"hide",title:s.value,"force-title":"",align:"center"},{default:i((()=>[d(y(s.value),1)])),_:2},1032,["title"])],2)],2)))),256)):(t(),n("div",Te," Список пуст "))],2),r(m,{disabled:c.isWheelActive,onActivateWheel:u.activateWheel,"roulette-list":u.rouletteList,winner:c.winner},null,8,["disabled","onActivateWheel","roulette-list","winner"])],2)};const Fe="roulette-data",Ue=()=>((e,t)=>{try{return e?JSON.parse(e):[]}catch(n){return R(t),alert("Не удалось распознать сохранённые данные. Хранилище было очищено"),[]}})(E(Fe),Fe),Ee=$({variants:Ue()});g([Ee.value],(()=>{U(Fe,JSON.stringify(Ee.value.variants))}));var Re={app:"_app_p14z1_1",main:"_main_p14z1_7"};const Ne={name:"App",components:{Wheel:De,Modal:A,Footer:T,Header:C,Button:M,Settings:Le},data:()=>({isModalOpen:!1}),provide:{wheelStore:{state:w(Ee),addVariant:e=>{const t={id:"_"+Date.now().toString(36).substr(2,9),value:e};Ee.value.variants.unshift(t)},regenerateStore:()=>{Ee.value={variants:Ue()}},setNewVariants:e=>{Ee.value.variants=e},removeVariant:e=>{const t=Ee.value.variants.findIndex((t=>t.id===e));Ee.value.variants.splice(t,1)},getActiveList:()=>w(Ee.value.variants)}},mounted(){console.log(`Built at ${new Date(1614516037850)}`)}};(Ne.__cssModules={}).$style=Re,Ne.render=function(e,s,a,o,d,c){const u=l("Header"),p=l("Wheel"),_=l("Footer"),m=l("Settings"),v=l("Modal");return t(),n("div",{class:e.$style.app},[r(u,{onOpenModal:s[1]||(s[1]=e=>d.isModalOpen=!0)}),r("div",{class:e.$style.main},[r(p)],2),r(_),(t(),n(S,{to:"body"},[d.isModalOpen?(t(),n(v,{key:0,onCloseModal:s[2]||(s[2]=e=>d.isModalOpen=!1)},{default:i((()=>[r(m)])),_:1})):k("",!0)]))],2)};x(Ne).mount("#app");
